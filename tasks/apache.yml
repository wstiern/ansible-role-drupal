---
- name: check if site apache config already exists
  stat: path={{ drupal_apache_conf_path }}/{{ drupal_apache_conf_file }}
  register: original
  
- name: check if site apache config backup already exists
  stat: path={{ drupal_apache_conf_path }}/{{ drupal_apache_conf_backup }}
  register: backup
  
- name: Make a backup copy of the site apache config file
  shell: cp {{ drupal_apache_conf_path }}/{{ drupal_apache_conf_file }} {{ drupal_apache_conf_path }}/{{ drupal_apache_conf_backup }}
  when: original.stat.exists and not backup.stat.exists
  
- name: Create an apache config file for site based on template
  template: src=drupal_apache.conf dest={{ drupal_apache_conf_path }}/{{ drupal_apache_conf_file }}
  notify: apache_restart
  
- name: a2ensite site
  command: a2ensite {{ drupal_apache_conf_file }}
  when: drupal_apache_mode == "vhost"
  notify: apache_restart
